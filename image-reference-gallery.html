<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artistic Image Reference Gallery (Final)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom artistic dark theme styling (Defaults) */
        :root {
            --color-primary: #1a1a2e; /* Deep Indigo/Navy */
            --color-accent: #e94560; /* Vibrant Red-Pink (DEFAULT) */
            --color-text: #f0f0f0;   /* Light Gray */
            --color-card: #2c2c47;   /* Slightly Lighter Indigo */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Apply smooth transition to elements that change color */
        .transition-all-ease {
            transition: all 0.3s ease-in-out;
        }

        .thumbnail:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            border-color: var(--color-accent); /* Dynamic border color */
        }

        .modal-bg {
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
        }

        .action-btn {
            /* Now using solid background color for the button for smooth color transition */
            background-color: var(--color-accent); 
            box-shadow: 0 4px 15px var(--color-accent, #e94560)40;
        }
        .action-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        /* Spinning animation for floating refresh button */
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        /* Custom styles for the circular color picker */
        #color-picker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 40px; 
            height: 40px;
            border: none;
            border-radius: 50%; 
            padding: 0;
            cursor: pointer;
            box-shadow: 0 0 0 3px var(--color-card);
            transition: all 0.2s ease;
        }
        /* Ensure the swatch inside the color input is circular */
        #color-picker::-webkit-color-swatch {
            border: none;
            border-radius: 50%;
        }
        #color-picker::-moz-color-swatch {
            border: none;
            border-radius: 50%;
        }

        /* Styling for the settings panel (Fixed Right Sidebar) */
        #settings-panel {
            top: 0;
            right: 0;
            width: 250px;
            height: 100%;
            background-color: var(--color-card);
            transform: translateX(250px);
            transition: transform 0.3s ease-in-out;
        }
        #settings-panel.open {
            transform: translateX(0);
        }

    </style>
    <!-- Configure Tailwind for custom colors if needed -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': 'var(--color-primary)',
                        'card-dark': 'var(--color-card)',
                        'accent': 'var(--color-accent)',
                    },
                }
            }
        }
    </script>
</head>
<body class="p-4 md:p-8">

    <!-- Settings Panel (Fixed Right Sidebar) -->
    <div id="settings-panel" class="fixed z-[70] p-6 shadow-2xl">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-accent">Site Settings</h3>
            <button onclick="toggleSettingsPanel()" class="text-gray-400 hover:text-accent focus:outline-none">
                 <!-- Close icon (X) -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        
        <!-- Home Button -->
        <div class="mb-6 border-b border-primary-dark pb-6">
            <a href="https://prayosh.github.io/the-artist/home.html" target="_blank"
               class="w-full text-center block text-white font-bold py-2 px-4 rounded-lg transition-all-ease action-btn focus:outline-none focus:ring-4 focus:ring-accent/50 hover:opacity-90">
                Go to Home Page
            </a>
            <p class="text-xs text-gray-500 mt-2 text-center">Opens in new tab</p>
        </div>

        <!-- Theme Color Picker -->
        <div class="mb-6 border-b border-primary-dark pb-6">
            <p class="text-sm font-medium mb-3 text-gray-300">Change Accent Theme Color:</p>
            <div class="flex items-center space-x-4">
                <input type="color" id="color-picker" value="#e94560" />
                <span class="text-sm text-gray-400">Choose a color</span>
            </div>
        </div>

        <!-- Reset Button -->
        <div>
            <button id="reset-theme-button" class="w-full text-white font-bold py-2 px-4 rounded-lg transition-all-ease focus:outline-none focus:ring-4 focus:ring-gray-500/50" style="background-color: #4a5568;">
                Reset to Default Theme
            </button>
        </div>
    </div>


    <!-- Main Header -->
    <header class="text-center mb-8 flex justify-center relative">
        <h1 class="text-4xl md:text-5xl font-extrabold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-accent to-pink-300">
            Image Reference Gallery
        </h1>
    </header>

    <!-- Gallery Container -->
    <main class="container mx-auto max-w-7xl">
        
        <!-- Grid for 10 sharp thumbnails -->
        <div id="gallery" class="grid grid-cols-2 sm:grid-cols-5 gap-3 md:gap-4">
            <!-- Thumbnails will be injected here by JavaScript -->
        </div>
    </main>
    
    <!-- Floating UTILITY Buttons -->
    
    <!-- Floating Menu Button (Fixed Bottom Right, NOW ALIGNED) -->
    <button id="floating-menu-button" onclick="toggleSettingsPanel()" class="fixed bottom-6 right-6 z-40 action-btn p-4 rounded-full shadow-2xl transition-all-ease focus:outline-none focus:ring-4 focus:ring-accent/50 hover:scale-105" aria-label="Open Menu">
        <!-- Menu Icon (Hamburger) - ICON CHANGED -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
    </button>
    
    <!-- Floating Refresh Button (Fixed Bottom Left - Randomize Button) -->
    <button id="floating-refresh-button" class="fixed bottom-6 left-6 z-40 action-btn p-4 rounded-full shadow-2xl transition-all-ease focus:outline-none focus:ring-4 focus:ring-accent/50 hover:scale-105" aria-label="Refresh All Images">
        <!-- SVG Icon for Refresh -->
        <svg id="refresh-icon" xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h5" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M20 20v-5h-5" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 12a8 8 0 0 1 16 0M4 12a8 8 0 0 0 16 0" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M20 12h-8" />
        </svg>
    </button>

    <!-- Full-Screen Modal for Large Image View -->
    <div id="modal" class="fixed inset-0 z-50 hidden modal-bg p-4 flex items-center justify-center transition-opacity" onclick="closeModal(event)">
        
        <div class="relative bg-card-dark rounded-xl shadow-2xl p-6 md:p-8 w-full max-w-4xl max-h-[90vh]" onclick="event.stopPropagation()">
            
            <!-- Close Button -->
            <button onclick="closeModal()" class="absolute top-3 right-3 text-gray-400 hover:text-accent transition-all-ease focus:outline-none z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <h3 class="text-2xl font-bold mb-4 text-accent text-center">Large Image View</h3>

            <!-- Image Container -->
            <div class="flex items-center justify-center bg-gray-700 rounded-lg overflow-hidden mb-4 aspect-square">
                <!-- Loading state -->
                <div id="modal-loading" class="text-gray-400 text-lg p-10">Loading Full Size Image...</div>
                <!-- Image element -->
                <img id="modal-image" class="hidden w-full h-auto object-contain max-h-[70vh] rounded-lg" alt="Large View Image">
            </div>

            <!-- Size Info -->
            <p id="size-info" class="text-center text-sm mb-6 text-gray-400">Size: <span id="current-size-display"></span></p>
            
        </div>
    </div>
    
    <!-- Custom Message Modal (Hidden by default) -->
    <div id="message-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center">
        <div class="bg-card-dark p-6 rounded-lg shadow-2xl max-w-xs text-center border border-accent">
            <h4 id="message-title" class="text-xl font-bold text-accent mb-2"></h4>
            <p id="message-body" class="text-gray-300"></p>
            <button onclick="document.getElementById('message-modal').classList.add('hidden')" class="mt-4 action-btn text-white px-4 py-2 rounded-full text-sm">OK</button>
        </div>
    </div>

    <script>
        // --- Configuration Constants ---
        const DEFAULT_ACCENT_COLOR = '#e94560'; 
        const ACCENT_COLOR_KEY = 'galleryThemeAccentColor'; 
        const NUM_THUMBNAILS = 10; 
        const THUMBNAIL_SIZE = 200; 
        const MIN_FULL_SIZE = 800; 
        const MAX_FULL_SIZE = 1200; 
        
        // --- DOM Elements ---
        const gallery = document.getElementById('gallery');
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modal-image');
        const sizeInfo = document.getElementById('current-size-display');
        const modalLoading = document.getElementById('modal-loading');
        const floatingRefreshButton = document.getElementById('floating-refresh-button'); 
        const refreshIcon = document.getElementById('refresh-icon');
        const settingsPanel = document.getElementById('settings-panel');
        const colorPicker = document.getElementById('color-picker');
        const resetThemeButton = document.getElementById('reset-theme-button');
        // Note: The floating menu button (formerly settings) is now identified as floating-menu-button but doesn't require a JS variable as it uses an onclick handler directly in HTML.

        // --- Utility Functions ---

        /**
         * Generates a random integer between MIN_FULL_SIZE and MAX_FULL_SIZE, inclusive.
         */
        function getRandomFullSize() {
            return Math.floor(Math.random() * (MAX_FULL_SIZE - MIN_FULL_SIZE + 1)) + MIN_FULL_SIZE;
        }

        /**
         * Creates a new full-size image URL using the provided image ID and random large dimensions.
         */
        function generateFullSizeUrl(imageId, width, height) {
            const cacheBuster = Math.random().toString(36).substring(2, 8);
            // Uses the specific ID to ensure the content is the same as the thumbnail's content.
            return `https://picsum.photos/id/${imageId}/${width}/${height}?random=${cacheBuster}`;
        }
        
        /**
         * Generates the URL for a small, sharp thumbnail.
         */
        function generateThumbnailUrl(imageId) {
             const cacheBuster = Math.random().toString(36).substring(2, 8);
             return `https://picsum.photos/id/${imageId}/${THUMBNAIL_SIZE}/${THUMBNAIL_SIZE}?random=${cacheBuster}`;
        }

        // --- Theme Functions ---

        /**
         * Applies the specified color to the CSS variable.
         */
        function applyTheme(color) {
            // Set the CSS variable for the accent color
            document.documentElement.style.setProperty('--color-accent', color);
            // Update the color picker's value
            colorPicker.value = color;
            // Update the gradient for the main title (requires dynamic update since it uses the CSS variable)
            const mainTitle = document.querySelector('h1');
            if (mainTitle) {
                // Keep the gradient structure but update the primary color point
                mainTitle.style.backgroundImage = `linear-gradient(to right, ${color}, ${color}80)`;
            }
        }

        /**
         * Loads theme color from local storage and applies it.
         */
        function loadTheme() {
            const savedColor = localStorage.getItem(ACCENT_COLOR_KEY);
            if (savedColor) {
                applyTheme(savedColor);
            } else {
                applyTheme(DEFAULT_ACCENT_COLOR); // Apply default if nothing saved
            }
        }

        /**
         * Handles color picker change event, applies the new color, and saves it.
         */
        function handleColorChange(event) {
            const newColor = event.target.value;
            applyTheme(newColor);
            localStorage.setItem(ACCENT_COLOR_KEY, newColor);
        }

        /**
         * Resets the theme to default and clears local storage.
         */
        function resetTheme() {
            applyTheme(DEFAULT_ACCENT_COLOR);
            localStorage.removeItem(ACCENT_COLOR_KEY);
        }

        /**
         * Toggles the visibility of the settings panel.
         */
        function toggleSettingsPanel() {
            settingsPanel.classList.toggle('open');
        }

        // --- Gallery Core Functionality ---

        /**
         * Opens the modal and triggers the load of the full-resolution image based on the clicked image's ID.
         */
        function openModal(imageId) {
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            
            // Show loading state immediately
            modalLoading.textContent = 'Loading Full Size Image...';
            modalImage.classList.add('hidden');
            modalLoading.classList.remove('hidden');
            sizeInfo.textContent = 'Calculating...';

            // 1. Determine the large size
            const newWidth = getRandomFullSize();
            const newHeight = getRandomFullSize();
            
            // 2. Generate the full-size URL using the clicked imageId
            const fullSizeUrl = generateFullSizeUrl(imageId, newWidth, newHeight);

            const tempImage = new Image();
            
            // Show size information immediately
            sizeInfo.textContent = `${newWidth}px x ${newHeight}px`;

            tempImage.onload = () => {
                // Update the visible image source only after the new image is loaded
                modalImage.src = fullSizeUrl;
                modalImage.classList.remove('hidden');
                modalLoading.classList.add('hidden');
            };

            tempImage.onerror = () => {
                console.error(`Modal Image ID ${imageId} failed to load.`);
                modalImage.classList.add('hidden');
                modalLoading.textContent = 'Image failed to load.';
            };
            
            // 3. Start loading the full-size image
            tempImage.src = fullSizeUrl;
        }

        /**
         * Closes the modal.
         */
        function closeModal(event) {
            // Check if the click was directly on the modal background or the close button
            if (!event || event.target === modal || event.target.closest('button.absolute')) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');
                modalImage.src = ''; 
            }
        }
        
        /**
         * Creates and appends the initial thumbnail elements to the gallery.
         */
        function initializeGallery() {
            gallery.innerHTML = ''; // Clear existing content
            for (let i = 0; i < NUM_THUMBNAILS; i++) {
                // Use a stable ID set for initial thumbnails (e.g., 10 to 19)
                const imageId = i + 10; 
                const thumbnailUrl = generateThumbnailUrl(imageId);

                const div = document.createElement('div');
                div.className = 'w-full aspect-square rounded-xl overflow-hidden cursor-pointer shadow-lg hover:shadow-xl transition-all-ease thumbnail border-4 border-card-dark';
                
                const img = document.createElement('img');
                img.src = thumbnailUrl;
                img.alt = `Thumbnail ${i + 1}`;
                img.className = 'w-full h-full object-cover';
                
                // Pass the image ID to openModal
                div.onclick = () => openModal(imageId); 

                div.appendChild(img);
                gallery.appendChild(div);
            }
        }
        
        /**
         * Refreshes all 10 thumbnails on the main gallery page.
         */
        function refreshAllThumbnails() {
            floatingRefreshButton.disabled = true;
            refreshIcon.classList.add('animate-spin-slow');

            const thumbnails = gallery.querySelectorAll('.thumbnail');
            const promises = [];

            thumbnails.forEach((div, index) => {
                // Generate a new, random image ID for the new thumbnail set
                const newImageId = Math.floor(Math.random() * 980) + 10;
                const newThumbnailUrl = generateThumbnailUrl(newImageId);
                
                const img = div.querySelector('img');
                
                // Update the stored image ID and the click handler
                div.onclick = () => openModal(newImageId); 

                const loadPromise = new Promise((resolve) => {
                    const tempImage = new Image();
                    tempImage.onload = () => {
                        img.src = newThumbnailUrl; 
                        resolve();
                    };
                    tempImage.onerror = () => {
                         console.error(`Failed to load a thumbnail image.`);
                         img.src = newThumbnailUrl; 
                         resolve();
                    };
                    tempImage.src = newThumbnailUrl; 
                });
                promises.push(loadPromise);
            });

            // Wait for all small images to load
            Promise.all(promises).finally(() => {
                floatingRefreshButton.disabled = false;
                refreshIcon.classList.remove('animate-spin-slow');
                console.log('All 10 thumbnails refreshed quickly.');
            });
        }

        // --- Initialization and Event Listeners ---

        window.onload = () => {
            loadTheme(); // Load saved theme on startup
            initializeGallery();
            
            // Add event listeners for functionality
            floatingRefreshButton.addEventListener('click', refreshAllThumbnails);
            colorPicker.addEventListener('input', handleColorChange);
            resetThemeButton.addEventListener('click', resetTheme);
        };
        
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (!modal.classList.contains('hidden')) {
                    closeModal();
                } else if (settingsPanel.classList.contains('open')) {
                    toggleSettingsPanel();
                }
            }
        });
        
    </script>
</body>
</html>
